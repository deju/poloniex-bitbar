#!/bin/bash

# <bitbar.title>BitCoin USD price at Poloniex</bitbar.title>
# <bitbar.version>v1.0</bitbar.version>
# <bitbar.author>deju.tu@gmail.com</bitbar.author>
# <bitbar.author.github>deju</bitbar.author.github>
# <bitbar.desc>Shows the last BitCoin price (in USD) on the Poloniex exchange</bitbar.desc>
# <bitbar.image>https://raw.githubusercontent.com/deju/poloniex-bitbar/master/icons/btc.png</bitbar.image>
# <bitbar.abouturl>https://bitcoin.org/en/</bitbar.abouturl>
# 

btcIconBase64='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'

xmrLast=$(curl -s https://poloniex.com/public?command=returnTicker | tr '}' '\n' | grep USDT_BTC | tr -d '{}"' | tr ':,' '\n' | grep -A1 "last" | tail -1)
# printf "$%.*f | image=%s\n" 2 "$xmrLast" "$btcIconBase64"
printf "BTC $%.*f\n" 2 "$xmrLast"
echo "---"
echo "BitCoin in Poloniex | href=\"https://poloniex.com/exchange#usdt_btc\""
echo "BitCoin homepage | href=\"https://bitcoin.org/en\""
echo "Poloniex Login page | href=\"https://poloniex.com/login\""



